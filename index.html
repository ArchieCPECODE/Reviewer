<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Reviewer</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Prevent horizontal scrolling */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .sidebar {
            width: 280px;
            flex-shrink: 0;
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.collapsed {
            transform: translateX(-100%);
        }
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                height: 100%;
                z-index: 100;
            }
            .sidebar.collapsed {
                transform: translateX(-100%);
            }
            .content-area {
                margin-left: 0;
            }
        }

        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }

        /* Custom modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        /* Quiz option styling */
        .quiz-option {
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }
        .quiz-option.correct {
            background-color: #d1fae5; /* green-100 */
            border-color: #34d399; /* green-400 */
        }
        .quiz-option.incorrect {
            background-color: #fee2e2; /* red-100 */
            border-color: #ef4444; /* red-500 */
        }
        .quiz-option.selected {
            border-color: #60a5fa; /* blue-400 */
            background-color: #eff6ff; /* blue-50 */
        }
        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Flashcard styling */
        .flashcard-container {
            perspective: 1000px;
        }
        .flashcard {
            width: 100%;
            height: 300px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .flashcard.flipped {
            transform: rotateY(180deg);
        }
        .flashcard-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
        }
        .flashcard-front {
            background-color: #f0f9ff; /* blue-50 */
            color: #1e3a8a; /* blue-900 */
        }
        .flashcard-back {
            background-color: #ecfdf5; /* green-50 */
            color: #065f46; /* green-900 */
            transform: rotateY(180deg);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Message Modal -->
    <div id="messageModalOverlay" class="modal-overlay">
        <div class="modal-content">
            <h3 id="messageModalTitle" class="text-xl font-semibold mb-4 text-gray-900"></h3>
            <p id="messageModalMessage" class="text-gray-700 mb-6"></p>
            <button id="messageModalCloseBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200">Close</button>
        </div>
    </div>

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar bg-gradient-to-br from-blue-700 to-blue-900 text-white p-6 flex flex-col shadow-lg">
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-3xl font-bold">Reviewer</h1>
                <button id="sidebarToggle" class="md:hidden text-white focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
            </div>
            <nav class="flex-grow">
                <ul>
                    <li class="mb-4">
                        <a href="#" data-screen="dashboard" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-600 transition duration-200">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 001 1h3m-6-11v10a1 1 0 001 1h3"></path></svg>
                            Dashboard
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#" data-screen="topics" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-600 transition duration-200">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.206 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.794 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.794 5 16.5 5c1.706 0 3.332.477 4.5 1.253v13C19.832 18.477 18.206 18 16.5 18c-1.706 0-3.332.477-4.5 1.253"></path></svg>
                            Topics
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#" data-screen="quiz" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-600 transition duration-200">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M.636 17.364l.707-.707M12 21v-1m-6.364-1.636l.707-.707M3 12H2m18 0h-1M16.5 12a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"></path></svg>
                            Quiz
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#" data-screen="flashcards" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-600 transition duration-200">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            Flashcards
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#" data-screen="community" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-600 transition duration-200">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h2a2 2 0 002-2V4a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2h2m0 0l4 4m-4-4v-2m4 2v-2m4-12H9m11 0a2 2 0 012 2v4m2-4H10a2 2 0 00-2 2v4m2-4H5a2 2 0 00-2 2v4"></path></svg>
                            Community
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#" data-screen="study-plan" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-600 transition duration-200">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            Study Plan
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="#" data-screen="progress" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-600 transition duration-200">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2-6h10a2 2 0 012 2v5a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2z"></path></svg>
                            Progress
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="mt-auto text-sm text-blue-200">
                User ID: <span id="displayUserId" class="font-mono break-all">Loading...</span>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto p-8 bg-gray-50">
            <button id="mobileSidebarToggle" class="md:hidden fixed top-4 left-4 z-50 bg-blue-600 text-white p-2 rounded-full shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>

            <!-- Dashboard Screen -->
            <section id="dashboardScreen" class="screen active">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-8">Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-md border border-blue-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-8 h-8 text-yellow-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.329 1.176l1.519 4.674c.3.921-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.519-4.674a1 1 0 00-.329-1.176l-3.976-2.888c-.783-.57-.381-1.81.588-1.81h4.915a1 1 0 00.95-.69l1.519-4.674z"></path></svg>
                            <h3 class="text-xl font-semibold text-gray-800">Total Points</h3>
                        </div>
                        <p id="dashboardPoints" class="text-5xl font-bold text-blue-600">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-green-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-8 h-8 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <h3 class="text-xl font-semibold text-gray-800">Topics Completed</h3>
                        </div>
                        <p id="dashboardCompletedTopics" class="text-5xl font-bold text-green-600">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-purple-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-8 h-8 text-purple-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.206 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.794 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.794 5 16.5 5c1.706 0 3.332.477 4.5 1.253v13C19.832 18.477 18.206 18 16.5 18c-1.706 0-3.332.477-4.5 1.253"></path></svg>
                            <h3 class="text-xl font-semibold text-gray-800">Latest Quiz Score</h3>
                        </div>
                        <p id="dashboardLatestQuizScore" class="text-5xl font-bold text-purple-600">N/A</p>
                    </div>
                </div>

                <div class="mt-10">
                    <h3 class="text-2xl font-semibold text-gray-900 mb-6">Quick Actions</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <button class="bg-blue-500 text-white py-4 px-6 rounded-xl shadow-md hover:bg-blue-600 transition duration-200 flex items-center justify-center text-lg font-medium" onclick="showScreen('quiz')">
                            <svg class="w-7 h-7 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M.636 17.364l.707-.707M12 21v-1m-6.364-1.636l.707-.707M3 12H2m18 0h-1M16.5 12a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"></path></svg>
                            Start Quiz
                        </button>
                        <button class="bg-green-500 text-white py-4 px-6 rounded-xl shadow-md hover:bg-green-600 transition duration-200 flex items-center justify-center text-lg font-medium" onclick="showScreen('flashcards')">
                            <svg class="w-7 h-7 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            Review Flashcards
                        </button>
                        <button class="bg-purple-500 text-white py-4 px-6 rounded-xl shadow-md hover:bg-purple-600 transition duration-200 flex items-center justify-center text-lg font-medium" onclick="showScreen('topics')">
                            <svg class="w-7 h-7 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.206 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.794 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.794 5 16.5 5c1.706 0 3.332.477 4.5 1.253v13C19.832 18.477 18.206 18 16.5 18c-1.706 0-3.332.477-4.5 1.253"></path></svg>
                            Browse Topics
                        </button>
                    </div>
                </div>
            </section>

            <!-- Topics Screen -->
            <section id="topicsScreen" class="screen">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-8">Topics</h2>
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Topic List -->
                    <div class="lg:w-1/3 bg-white p-6 rounded-xl shadow-md border border-gray-200 h-full max-h-[calc(100vh-160px)] overflow-y-auto">
                        <h3 class="text-2xl font-semibold text-gray-900 mb-6">Course Outline</h3>
                        <ul id="topicList">
                            <!-- Topics will be rendered here by JavaScript -->
                        </ul>
                    </div>

                    <!-- Topic Content -->
                    <div class="lg:w-2/3 bg-white p-6 rounded-xl shadow-md border border-gray-200 h-full max-h-[calc(100vh-160px)] overflow-y-auto">
                        <div id="topicContentDisplay">
                            <h3 class="text-2xl font-semibold text-gray-900 mb-4" id="currentTopicTitle">Select a topic from the left.</h3>
                            <div id="currentTopicBody" class="prose max-w-none text-gray-700">
                                <p>This section will display the content of the selected topic or subtopic.</p>
                            </div>
                            <img id="currentTopicImage" src="" alt="Topic Image" class="hidden w-full h-auto rounded-lg mt-6 object-cover" onerror="this.style.display='none';">
                            <button id="markTopicCompleteBtn" class="mt-6 bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition duration-200 hidden">Mark as Completed</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quiz Screen -->
            <section id="quizScreen" class="screen">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-8">Quiz</h2>
                <div id="quizContainer" class="bg-white p-8 rounded-xl shadow-md border border-blue-200">
                    <div id="quizStartScreen">
                        <h3 class="text-2xl font-semibold text-gray-900 mb-4">Ready for a Quiz?</h3>
                        <p class="text-gray-700 mb-6">Test your knowledge on computer networks.</p>
                        <button id="startQuizBtn" class="bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition duration-200 text-lg">Start Quiz</button>
                    </div>

                    <div id="quizQuestionScreen" class="hidden">
                        <div class="flex justify-between items-center mb-6">
                            <p class="text-lg font-medium text-gray-700">Question <span id="currentQuestionNumber">1</span> of <span id="totalQuestions">10</span></p>
                            <p class="text-lg font-medium text-gray-700">Time Left: <span id="quizTimer" class="font-bold text-red-500">00:00</span></p>
                        </div>
                        <h3 id="quizQuestionText" class="text-xl font-semibold text-gray-900 mb-6"></h3>
                        <div id="quizOptionsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <!-- Options will be rendered here -->
                        </div>
                        <div class="flex justify-between items-center">
                            <button id="prevQuestionBtn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400 transition duration-200 flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                                Previous
                            </button>
                            <button id="nextQuestionBtn" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200 flex items-center">
                                Next
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                            <button id="submitQuizBtn" class="bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition duration-200 hidden">Submit Quiz</button>
                        </div>
                    </div>

                    <div id="quizResultScreen" class="hidden text-center">
                        <h3 class="text-3xl font-bold text-gray-900 mb-4">Quiz Results</h3>
                        <p class="text-lg text-gray-700 mb-2">You scored: <span id="quizScore" class="font-bold text-blue-600 text-2xl"></span> / <span id="quizTotalQuestions" class="font-bold text-gray-800 text-2xl"></span></p>
                        <p class="text-lg text-gray-700 mb-6">Points earned: <span id="quizPointsEarned" class="font-bold text-yellow-500 text-2xl"></span></p>
                        <button id="retakeQuizBtn" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200 mr-4">Retake Quiz</button>
                        <button id="backToDashboardBtn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400 transition duration-200" onclick="showScreen('dashboard')">Back to Dashboard</button>
                    </div>
                </div>
            </section>

            <!-- Flashcards Screen -->
            <section id="flashcardsScreen" class="screen">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-8">Flashcards</h2>
                <div class="bg-white p-8 rounded-xl shadow-md border border-purple-200 text-center">
                    <div id="flashcardContainer" class="flashcard-container w-full max-w-xl mx-auto mb-8">
                        <div id="flashcard" class="flashcard">
                            <div id="flashcardFront" class="flashcard-face flashcard-front">
                                <p class="text-2xl font-semibold" id="flashcardQuestion">Click 'Start Flashcards' to begin!</p>
                            </div>
                            <div id="flashcardBack" class="flashcard-face flashcard-back">
                                <p class="text-xl" id="flashcardAnswer"></p>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-center items-center gap-4">
                        <button id="prevFlashcardBtn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400 transition duration-200 flex items-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            Previous
                        </button>
                        <button id="flipFlashcardBtn" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>Flip Card</button>
                        <button id="nextFlashcardBtn" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200 flex items-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Next
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                    <button id="startFlashcardsBtn" class="mt-6 bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition duration-200 text-lg">Start Flashcards</button>
                </div>
            </section>

            <!-- Community Screen -->
            <section id="communityScreen" class="screen">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-8">Community Forum</h2>
                <div class="bg-white p-8 rounded-xl shadow-md border border-yellow-200">
                    <h3 class="text-2xl font-semibold text-gray-900 mb-6">Ask a Question</h3>
                    <div class="mb-6">
                        <textarea id="newQuestionText" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 resize-y min-h-[100px]" placeholder="Type your question here..."></textarea>
                        <button id="postQuestionBtn" class="mt-4 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200">Post Question</button>
                    </div>

                    <h3 class="text-2xl font-semibold text-gray-900 mb-6 mt-10">Community Questions</h3>
                    <div id="communityQuestionsList" class="space-y-4">
                        <p class="text-gray-600" id="noCommunityQuestions">No community questions yet. Be the first to ask!</p>
                        <!-- Community questions will be rendered here by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Study Plan Screen -->
            <section id="studyPlanScreen" class="screen">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-8">Study Plan</h2>
                <div class="bg-white p-8 rounded-xl shadow-md border border-pink-200">
                    <h3 class="text-2xl font-semibold text-gray-900 mb-6">Your Personalized Plan</h3>
                    <div class="mb-6 flex flex-col sm:flex-row gap-4">
                        <input type="text" id="newStudyPlanItem" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Add a new study goal or task">
                        <button id="addStudyPlanItemBtn" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200">Add to Plan</button>
                    </div>

                    <div id="studyPlanList" class="space-y-3">
                        <p class="text-gray-600" id="noStudyPlanItems">No study plan items yet. Add some to get started!</p>
                        <!-- Study plan items will be rendered here by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Progress Screen -->
            <section id="progressScreen" class="screen">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-8">Progress Report</h2>
                <div class="bg-white p-8 rounded-xl shadow-md border border-teal-200">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-blue-50 p-5 rounded-lg shadow-sm">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">Total Points Earned</h3>
                            <p id="progressPoints" class="text-4xl font-bold text-blue-600">0</p>
                        </div>
                        <div class="bg-green-50 p-5 rounded-lg shadow-sm">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">Topics Mastered</h3>
                            <ul id="progressCompletedTopics" class="list-disc list-inside text-gray-700">
                                <!-- Completed topics will be rendered here -->
                            </ul>
                            <p id="noProgressCompletedTopics" class="text-gray-600 hidden">No topics completed yet.</p>
                        </div>
                    </div>

                    <h3 class="text-2xl font-semibold text-gray-900 mb-4">Quiz History</h3>
                    <div id="progressQuizHistory" class="space-y-4">
                        <p class="text-gray-600" id="noProgressQuizHistory">No quiz history available.</p>
                        <!-- Quiz history will be rendered here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, onSnapshot, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global application state
        window.appState = {
            userId: null,
            isAuthReady: false,
            userData: {
                points: 0,
                completedTopics: [],
                quizScores: {},
                studyPlan: {},
                lastActive: new Date().toISOString(),
            },
            questions: [], // Community questions
            currentScreen: 'dashboard',
            quiz: {
                currentQuestionIndex: 0,
                selectedAnswer: null,
                isAnswered: false,
                score: 0,
                timer: null,
                timeLeft: 60, // seconds per question
                quizQuestions: [], // Questions for the current quiz
            },
            flashcards: {
                currentFlashcardIndex: 0,
                isFlipped: false,
                flashcardData: [], // All flashcards
            },
            studyPlan: {
                items: [],
            },
            messageModal: {
                title: '',
                message: '',
                isVisible: false,
            }
        };

        // Firebase configuration and initialization
        // Provide placeholder values for local development if not in Canvas environment
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "YOUR_API_KEY", // Replace with your Firebase project's API Key
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com", // Replace with your Firebase project's Auth Domain
            projectId: "YOUR_PROJECT_ID", // Replace with your Firebase project ID
            storageBucket: "YOUR_PROJECT_ID.appspot.com", // Replace with your Firebase project's Storage Bucket
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID", // Replace with your Firebase project's Messaging Sender ID
            appId: "YOUR_APP_ID" // Replace with your Firebase project's App ID
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-exam-reviewer-app';

        // --- Data Definitions (Moved from React component) ---
        const topicsData = [
            {
                id: 'what-is-network',
                title: 'What is a Computer Network?',
                content: "A computer network is a group of interconnected computers and other devices that are linked together to share resources, exchange data, and communicate with each other.",
                imageUrl: "https://placehold.co/600x400/ADD8E6/000000?text=Network+Diagram",
            },
            {
                id: 'how-network-works',
                title: 'How Does a Computer Network Work?',
                content: "A computer network works by connecting two or more devices so they can share information and resources such as files, internet access, and printers efficiently and securely.",
                imageUrl: "https://placehold.co/600x400/ADD8E6/000000?text=Network+Connection",
            },
            {
                id: 'evolution-network',
                title: 'Evolution of Computer Networks',
                subtopics: [
                    {
                        id: 'evolution-summary',
                        title: 'Summary Table',
                        type: 'table',
                        data: [
                            ['Year', 'Development', 'Services'],
                            ['1950\'s-0\'s', 'Standalone Computers', 'Offline Data Storage'],
                            ['Late 60\'s-70\'s', 'ARPANET, packet switching', 'Email, remote login'],
                            ['1980s', 'TCP/IP, LANs, DNS', 'File transfer, email'],
                            ['1990s', 'World Wide Web, browsers', 'Websites, e-commerce, online services'],
                            ['2000s', 'Broadband, Wi-Fi, multimedia', 'Video streaming, social media, VoIP'],
                            ['2010s', 'Cloud computing, smartphones', 'Cloud apps, mobile services, collaboration'],
                            ['2020s+', 'IoT, 5G, AI', 'Smart devices, AI assistants, secure networks'],
                        ],
                    },
                    {
                        id: 'evolution-early',
                        title: '1. Early Networking Concepts (1950s-1960s)',
                        content: `
                            <ul>
                                <li>Communication was manual.</li>
                                <li>Example: SAGE (Semi-Automatic Ground Environment)</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'evolution-arpanet',
                        title: '2. ARPANET (1969-1970s)',
                        content: `
                            <ul>
                                <li>Advanced Research Projects Agency Network.</li>
                                <li>Used packet switching to send data efficiently.</li>
                                <li>Example: Email</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'evolution-protocols-lans',
                        title: '3. Introduction of Protocols and LANs (1970s-1980s)',
                        content: `
                            <ul>
                                <li>TCP/IP protocol was developed (standardized in 1983).</li>
                                <li>LANs (Local Area Networks) in businesses and schools.</li>
                                <li>Example: Ethernet LAN used in offices for sharing printers and files.</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'evolution-www',
                        title: '4. World Wide Web and Commercial Internet (1990s)',
                        content: `
                            <ul>
                                <li>Tim Berners-Lee invented the World Wide Web (1991).</li>
                                <li>Introduction of HTTP, HTML, web browsers (e.g., Mosaic, Netscape).</li>
                                <li>ISPs began offering commercial internet access.</li>
                                <li>Examples: Yahoo, Amazon, eBay, Google emerged.</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'evolution-wireless-broadband',
                        title: '5. Wireless, Broadband, and Multimedia (2000s)',
                        content: `
                            <ul>
                                <li>Broadband (DSL, cable) replaced dial-up.</li>
                                <li>Wi-Fi networks became standard in homes, cafes, and schools.</li>
                                <li>Rise of social media, video streaming, and online gaming.</li>
                                <li>Examples: Facebook, YouTube, Twitter</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'evolution-mobile-cloud-iot',
                        title: '6. Mobile Internet, Cloud, and IoT (2010s-Present)',
                        content: `
                            <ul>
                                <li>4G/5G mobile networks, cloud computing, and Internet of Things (IoT).</li>
                                <li>Devices like smartphones, smartwatches, and smart TVs all networked.</li>
                                <li>Examples: Google Drive, Zoom, and Netflix</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'evolution-ai-quantum',
                        title: '7. AI and Quantum Networking (Emerging)',
                        content: `
                            <ul>
                                <li>Integration of AI in networking (self-healing, optimized routing).</li>
                                <li>Development of high-speed communication.</li>
                                <li>Example: AI-managed networks</li>
                            </ul>
                        `,
                    },
                ],
            },
            {
                id: 'types-access-network',
                title: 'Types of Access Network',
                subtopics: [
                    {
                        id: 'internet',
                        title: 'Internet',
                        content: "Is a global public network that connects millions of computers and devices worldwide.",
                    },
                    {
                        id: 'extranet',
                        title: 'Extranet',
                        content: "Is a private network that allows authorized external users (like clients, suppliers, or partners) to access parts of an organization's intranet.",
                    },
                    {
                        id: 'intranet',
                        title: 'Intranet',
                        content: "Is a private network used within an organization (like a company or school) to share internal information and resources.",
                    },
                ],
            },
            {
                id: 'types-computer-network',
                title: 'Types of Computer Networks',
                subtopics: [
                    {
                        id: 'lan',
                        title: '1. LAN (Local Area Network)',
                        content: 'Covers small areas.',
                    },
                    {
                        id: 'wan',
                        title: '2. WAN (Wide Area Network)',
                        content: 'Covers a large geographical area.',
                    },
                    {
                        id: 'man',
                        title: '3. MAN (Metropolitan Area Network)',
                        content: 'Covers a city or large campus.',
                    },
                    {
                        id: 'pan',
                        title: '4. PAN (Personal Area Network)',
                        content: 'Small, personal network.',
                    },
                ],
            },
            {
                id: 'types-protocols',
                title: 'Types of Protocols',
                content: "Protocols are a set of rules that determine how data is transmitted and received over a network.",
                subtopics: [
                    {
                        id: 'communication-protocol',
                        title: '1. Communication Protocol',
                        content: `
                            <ul>
                                <li>TCP/IP (Transmission Control Protocol / Internet Protocol)</li>
                                <li><strong>TCP:</strong> Breaks data into packets.</li>
                                <li><strong>IP:</strong> Assigns addresses and routes the packets to the correct destination.</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'web-browsing-protocols',
                        title: '2. Web and Browsing Protocols',
                        content: `
                            <ul>
                                <li>HTTP/HTTPS (HyperText Transfer Protocol / Secure)</li>
                                <li>Used for accessing websites in browsers.</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'file-transfer-protocol',
                        title: '3. File Transfer Protocol',
                        content: `
                            <ul>
                                <li>FTP (File Transfer Protocol)</li>
                                <li>Used to transfer files between computers over a network.</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'email-protocols',
                        title: '4. Email Protocols',
                        content: `
                            <ul>
                                <li>SMTP / POP3 / IMAP (Email Protocols)</li>
                                <li><strong>SMTP:</strong> Simple Mail Transfer Protocol</li>
                                <li><strong>POP3:</strong> Post Office Protocol</li>
                                <li><strong>IMAP:</strong> Internet Message Access Protocol</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'dns',
                        title: '5. DNS (Domain Name System)',
                        content: 'Translates human-friendly domain names into IP addresses.',
                    },
                    {
                        id: 'dhcp',
                        title: '6. DHCP (Dynamic Host Configuration Protocol)',
                        content: 'Automatically assigns IP addresses to devices on a network.',
                    },
                    {
                        id: 'arp',
                        title: '7. ARP (Address Resolution Protocol)',
                        content: 'Helps find the physical (MAC) address that corresponds to an IP address on a local network.',
                    },
                ],
            },
            {
                id: 'lan-wan',
                title: 'LAN and WAN: Devices, Protocols, and Standards',
                subtopics: [
                    {
                        id: 'lan-devices',
                        title: 'Devices for LAN',
                        content: `
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="p-3 border rounded-lg shadow-sm bg-blue-50">
                                    <h5 class="font-semibold text-blue-800 mb-1">Switch</h5>
                                    <p class="text-gray-700 text-sm">Connects multiple devices within a LAN.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-blue-50">
                                    <h5 class="font-semibold text-blue-800 mb-1">Router</h5>
                                    <p class="text-gray-700 text-sm">Connects LANs to other networks or the internet.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-blue-50">
                                    <h5 class="font-semibold text-blue-800 mb-1">Access Point (AP)</h5>
                                    <p class="text-gray-700 text-sm">Provides wireless connectivity to a wired LAN.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-blue-50">
                                    <h5 class="font-semibold text-blue-800 mb-1">Network Interface Card (NIC)</h5>
                                    <p class="text-gray-700 text-sm">Hardware in a computer/device for network connectivity.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-blue-50">
                                    <h5 class="font-semibold text-blue-800 mb-1">Hub</h5>
                                    <p class="text-gray-700 text-sm">Basic device for connecting LAN devices (broadcasts data to all ports).</p>
                                </div>
                            </div>
                        `,
                        imageUrl: "https://placehold.co/600x300/ADD8E6/000000?text=LAN+Devices+Diagram",
                    },
                    {
                        id: 'lan-protocols',
                        title: 'Protocols for LAN',
                        content: `
                            <ul>
                                <li><strong>Ethernet:</strong> The fundamental protocol for wired LAN communication.</li>
                                <li><strong>Wi-Fi:</strong> The standard for wireless LANs.</li>
                                <li><strong>ARP (Address Resolution Protocol):</strong> Essential for devices to find each other's physical hardware address on the LAN.</li>
                                <li><strong>STP (Spanning Tree Protocol):</strong> Prevents loops in Ethernet networks with redundant paths.</li>
                                <li><strong>TCP/IP (Transmission Control Protocol/Internet Protocol):</strong> TCP ensures reliable data delivery; IP handles addressing and routing.</li>
                                <li><strong>DHCP (Dynamic Host Configuration Protocol):</strong> Automatically assigns IP addresses and other network settings to devices on the AN.</li>
                                <li><strong>ICMP (Internet Control Message Protocol):</strong> Used for diagnostic and control messages.</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'wan-devices',
                        title: 'Devices for WAN',
                        content: `
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="p-3 border rounded-lg shadow-sm bg-purple-50">
                                    <h5 class="font-semibold text-purple-800 mb-1">Modem</h5>
                                    <p class="text-gray-700 text-sm">Converts digital signals to analog (and vice versa) for transmission over phone lines, cable, or fiber.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-purple-50">
                                    <h5 class="font-semibold text-purple-800 mb-1">Router</h5>
                                    <p class="text-gray-700 text-sm">Connects LANs to other networks or the internet.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-purple-50">
                                    <h5 class="font-semibold text-purple-800 mb-1">WAN Switch</h5>
                                    <p class="text-gray-700 text-sm">Switches traffic across a service provider's WAN infrastructure.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-purple-50">
                                    <h5 class="font-semibold text-purple-800 mb-1">CSU/DSU (Channel Service Unit/Data Service Unit)</h5>
                                    <p class="text-gray-700 text-sm">Converts digital WAN signals for use by routers.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-purple-50">
                                    <h5 class="font-semibold text-purple-800 mb-1">Firewall</h5>
                                    <p class="text-gray-700 text-sm">Protects WAN-connected networks by controlling incoming/outgoing traffic.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-purple-50">
                                    <h5 class="font-semibold text-purple-800 mb-1">Access Server</h5>
                                    <p class="text-gray-700 text-sm">Manages remote access to a network via dial-up, VPN, or terminal servers.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-purple-50">
                                    <h5 class="font-semibold text-purple-800 mb-1">Multiplexer (MUX)</h5>
                                    <p class="text-gray-700 text-sm">Combines multiple signals over a single communication line.</p>
                                </div>
                            </div>
                        `,
                    },
                    {
                        id: 'wan-protocols',
                        title: 'Protocols for WAN',
                        content: `
                            <ul>
                                <li><strong>PPP (Point-to-Point Protocol):</strong> Used over serial links to establish direct WAN connections.</li>
                                <li><strong>HDLC (High-Level Data Link Control):</strong> Encapsulates data for transmission across serial WAN links.</li>
                                <li><strong>MPLS (Multiprotocol Label Switching):</strong> High-performance protocol that uses short labels instead of long network addresses to route data quickly.</li>
                                <li><strong>ATM (Asynchronous Transfer Mode):</strong> Used in older telecom backbones and WANs for multimedia traffic.</li>
                                <li><strong>IPSec (Internet Protocol Security):</strong> A suite of protocols used to encrypt and secure IP communications.</li>
                                <li><strong>BGP (Border Gateway Protocol):</strong> The core routing protocol of the internet. Determines the best path between large networks (Autonomous Systems).</li>
                            </ul>
                        `,
                    },
                    {
                        id: 'network-standards',
                        title: 'Network Standards',
                        content: `
                            <p class="text-lg text-gray-700 mb-4">Network standards are agreed-upon rules and specifications that ensure compatibility and interoperability between different network devices and systems.</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="p-3 border rounded-lg shadow-sm bg-green-50 text-center">
                                    <h5 class="font-semibold text-green-800 mb-1">IEEE 802.3 (Ethernet)</h5>
                                    <p class="text-gray-700 text-sm">Defines wired LAN communication.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-green-50 text-center">
                                    <h5 class="font-semibold text-green-800 mb-1">IEEE 802.11 (Wi-Fi)</h5>
                                    <p class="text-gray-700 text-sm">Defines wireless LAN communication.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-green-50 text-center">
                                    <h5 class="font-semibold text-green-800 mb-1">TCP/IP Protocol Suite</h5>
                                    <p class="text-gray-700 text-sm">Fundamental protocol suite for internetworking and the internet.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-green-50 text-center">
                                    <h5 class="font-semibold text-green-800 mb-1">ITU-T G.992</h5>
                                    <p class="text-gray-700 text-sm">Standard for DSL broadband internet.</p>
                                </div>
                                <div class="p-3 border rounded-lg shadow-sm bg-green-50 text-center">
                                    <h5 class="font-semibold text-green-800 mb-1">MPLS</h5>
                                    <p class="text-gray-700 text-sm">Efficient routing over WAN.</p>
                                </div>
                            </div>
                        `,
                        imageUrl: "https://placehold.co/600x300/ADD8E6/000000?text=Network+Standards+Diagram",
                    },
                ],
            },
            {
                id: 'network-topology',
                title: 'Network Topology',
                content: "Network topology refers to the arrangement of a network which comprises of nodes and connecting lines via sender and receiver.",
                subtopics: [
                    {
                        id: 'bus-topology',
                        title: 'Bus Topology',
                        content: `
                            <p class="text-gray-700 mb-2">A bus topology is multipoint. One long cable acts as a backbone to link all the devices in a network. Nodes are connected to the bus cable by drop lines and taps. A drop line is a connection running between the device and the main cable. A tap is a connector that either splices into the main cable or punctures the sheathing of a cable to create a contact with the metallic core. As a signal travels along the backbone, some of its energy is transformed into heat. Therefore, it becomes weaker and weaker as it travels farther and farther. For this reason there is a limit on the number of taps a bus can support and on the distance between those taps.</p>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Features:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>It transmits data only in one direction.</li>
                                <li>Every device is connected to a single cable.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Advantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>It is cost effective.</li>
                                <li>Cable required is least compared to other network topology.</li>
                                <li>Used in small networks.</li>
                                <li>It is easy to understand.</li>
                                <li>Easy to expand joining two cables together.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Disadvantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Cables fails then whole network fails.</li>
                                <li>If network traffic is heavy or nodes are more the performance of the network decreases.</li>
                                <li>Cable has a limited length.</li>
                                <li>It is slower than the ring topology.</li>
                            </ul>
                        `,
                        imageUrl: "https://placehold.co/400x200/ADD8E6/000000?text=Bus+Topology",
                    },
                    {
                        id: 'ring-topology',
                        title: 'Ring Topology',
                        content: `
                            <p class="text-gray-700 mb-2">In a ring topology, each device has a dedicated point-to-point connection with only the two devices on either side of it. A signal is passed along the ring in one direction, from device to device, until it reaches its destination. Each device in the ring incorporates a repeater. When a device receives a signal intended for another device, its repeater regenerates the bits and passes them along.</p>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Features:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>A number of repeaters are used for Ring topology with large number of nodes, because if someone wants to send some data to the last node in the ring topology with 100 nodes, then the data will have to pass through 99 nodes to reach the 100th node. Hence to prevent data loss repeaters are used in the network.</li>
                                <li>The transmission is unidirectional, but it can be made bidirectional by having 2 connections between each Network Node, it is called Dual Ring Topology.</li>
                                <li>Data is transferred in a sequential manner that is bit by bit. Data transmitted, has to pass through each node the network, till the destination node.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Advantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Fast performance with few nodes and low network traffic.</li>
                                <li>Transmitting network is not affected by high traffic or by adding more nodes, as only the nodes having tokens can transmit data.</li>
                                <li>Cheap to install and expand.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Disadvantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Troubleshooting is difficult in ring topology.</li>
                                <li>Adding or deleting the computers disturbs the network activity.</li>
                                <li>Failure of one computer disturbs the whole network.</li>
                            </ul>
                        `,
                        imageUrl: "https://placehold.co/400x200/ADD8E6/000000?text=Ring+Topology",
                    },
                    {
                        id: 'star-topology',
                        title: 'Star Topology',
                        content: `
                            <p class="text-gray-700 mb-2">In a star topology, each device has a dedicated point-to-point link only to a central controller, usually called a hub. The devices are not directly linked to one another. Unlike a mesh topology, a star topology does not allow direct traffic between devices. The controller acts as an exchange: if one device wants to send data to another, it sends the data to the controller, which then relays the data to the other connected device.</p>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Features:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Every node has its own dedicated connection to the hub.</li>
                                <li>Hub acts as a repeater for data flow.</li>
                                <li>Can be used with twisted pair, Optical Fiber or coaxial cable.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Advantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Fast performance with few nodes and low network traffic.</li>
                                <li>Hub can be upgraded easily.</li>
                                <li>Easy to troubleshoot.</li>
                                <li>Easy to setup and modify.</li>
                                <li>Only that node is affected which has failed, rest of the nodes can work smoothly.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Disadvantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Cost of installation is high.</li>
                                <li>Expensive to use.</li>
                                <li>If the hub fails then the whole network is stopped because all the nodes depend on the hub.</li>
                                <li>Performance is based on the hub that is it depends on its capacity.</li>
                            </ul>
                        `,
                        imageUrl: "https://placehold.co/400x200/ADD8E6/000000?text=Star+Topology",
                    },
                    {
                        id: 'mesh-topology',
                        title: 'Mesh Topology',
                        content: `
                            <p class="text-gray-700 mb-2">It is a point-to-point connection to other nodes or devices. All the network nodes are connected to each other.</p>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Types of Mesh Topology:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li><strong>Partial Mesh Topology:</strong> In this topology some of the systems are connected in the same fashion as mesh topology but some devices are only connected to two or three devices.</li>
                                <li><strong>Full Mesh Topology:</strong> Each and every nodes or devices are connected to each other.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Features:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Fully connected.</li>
                                <li>Robust.</li>
                                <li>Not flexible.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Advantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Each connection can carry its own data load.</li>
                                <li>It is robust.</li>
                                <li>Fault is diagnosed easily.</li>
                                <li>Provides security and privacy.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Disadvantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Installation configuration is difficult.</li>
                                <li>Cabling cost is more.</li>
                                <li>Bulk wiring is required.</li>
                            </ul>
                        `,
                        imageUrl: "https://placehold.co/400x200/ADD8E6/000000?text=Mesh+Topology",
                    },
                    {
                        id: 'tree-topology',
                        title: 'Tree Topology',
                        content: `
                            <p class="text-gray-700 mb-2">It has a root node and all other nodes are connected to it forming a hierarchy. It is also called hierarchical topology. It should at least have three levels to the hierarchy.</p>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Features:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Ideal if workstations are located in groups.</li>
                                <li>Used in Wide Area Network.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Advantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Extension of bus and star topologies.</li>
                                <li>Expansion of nodes is possible and easy.</li>
                                <li>Easily managed and maintained.</li>
                                <li>Error detection is easily done.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Disadvantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Heavily cabled.</li>
                                <li>Costly.</li>
                                <li>If more nodes are added maintenance is difficult.</li>
                                <li>Central hub fails, network fails.</li>
                            </ul>
                        `,
                        imageUrl: "https://placehold.co/400x200/ADD8E6/000000?text=Tree+Topology",
                    },
                    {
                        id: 'hybrid-topology',
                        title: 'Hybrid Topology',
                        content: `
                            <p class="text-gray-700 mb-2">It is two different types of topologies which is a mixture of two or more topologies. For example if in an office in one department ring topology is used and in another star topology is used, connecting these topologies will result in Hybrid Topology (ring topology and star topology).</p>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Features:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>It is a combination of two or more topologies.</li>
                                <li>Inherits the advantages and disadvantages of the topologies included.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Advantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Reliable as Error detecting and troubleshooting is easy.</li>
                                <li>Effective.</li>
                                <li>Scalable as size can be increased easily.</li>
                                <li>Flexible.</li>
                            </ul>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">Disadvantages:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li>Complex in design.</li>
                                <li>Costly.</li>
                                <li>Bulk wiring is required.</li>
                            </ul>
                        `,
                        imageUrl: "https://placehold.co/400x200/ADD8E6/000000?text=Hybrid+Topology",
                    },
                ],
            },
            {
                id: 'transmission-media',
                title: 'Transmission Media',
                content: "Transmission media refers to the physical or wireless channel over which data travels from sender to receiver. It can be broadly categorized into Guided (wired) and Unguided (wireless) media.",
                imageUrl: "http://googleusercontent.com/file_content/1", // image_68fb83.png
                subtopics: [
                    {
                        id: 'guided-media',
                        title: 'Guided Media (Wired)',
                        content: "Data travels through a physical medium (like cables).",
                        subtopics: [
                            {
                                id: 'twisted-pair-cables',
                                title: 'Twisted Pair Cables',
                                content: `
                                    <h5 class="font-semibold text-gray-800 mb-1">A. Unshielded Twisted Pair (UTP)</h5>
                                    <ul class="list-disc list-inside text-gray-700 mb-2">
                                        <li>Common Types: Cat5, Cat5e, Cat6, Cat6a, Cat7, Cat8</li>
                                        <li>Use: Ethernet networks (LAN)</li>
                                    </ul>
                                    <h5 class="font-semibold text-gray-800 mb-1">B. Shielded Twisted Pair (STP)</h5>
                                    <ul class="list-disc list-inside text-gray-700">
                                        <li>Use: Environments with high interference (e.g., factories)</li>
                                    </ul>
                                `,
                                imageUrl: "http://googleusercontent.com/file_content/2", // image_68fbc5.png
                            },
                            {
                                id: 'coaxial-cable',
                                title: 'Coaxial Cable',
                                content: `
                                    <ul class="list-disc list-inside text-gray-700">
                                        <li>Types: RG-6, RG-59</li>
                                        <li>Use: Older Ethernet (10Base2, 10Base5), cable internet, CCTV</li>
                                    </ul>
                                `,
                                imageUrl: "http://googleusercontent.com/file_content/3", // image_68fe8d.png (shows coaxial)
                            },
                            {
                                id: 'fiber-optic-cable',
                                title: 'Fiber Optic Cable',
                                content: `
                                    <h5 class="font-semibold text-gray-800 mb-1">a. Single Mode Fiber (SMF)</h5>
                                    <ul class="list-disc list-inside text-gray-700 mb-2">
                                        <li>Use: Long-distance, high-speed connections (10+ km)</li>
                                        <li>Pros: High bandwidth, low loss over long distances</li>
                                    </ul>
                                    <h5 class="font-semibold text-gray-800 mb-1">b. Multi Mode Fiber (MMF)</h5>
                                    <ul class="list-disc list-inside text-gray-700">
                                        <li>Use: Short-distance (up to 2 km), LAN, data centers</li>
                                    </ul>
                                `,
                                imageUrl: "http://googleusercontent.com/file_content/3", // image_68fe8d.png (shows fiber optic)
                            },
                        ],
                    },
                    {
                        id: 'unguided-media',
                        title: 'Unguided Media (Wireless)',
                        content: "Data is transmitted through air or space using electromagnetic waves.",
                        subtopics: [
                            {
                                id: 'radio-waves',
                                title: 'Radio Waves',
                                content: `
                                    <ul class="list-disc list-inside text-gray-700">
                                        <li>Range: From a few meters (Bluetooth) to several kilometers (FM radio)</li>
                                        <li>Signal Type: EM waves</li>
                                    </ul>
                                `,
                                imageUrl: "http://googleusercontent.com/file_content/4", // image_68fec8.png
                            },
                            {
                                id: 'microwave',
                                title: 'Microwave',
                                content: "Microwaves are high-frequency radio waves used for line-of-sight communication.",
                                imageUrl: "http://googleusercontent.com/file_content/4", // image_68fec8.png
                            },
                            {
                                id: 'infrared',
                                title: 'Infrared',
                                content: "Infrared waves are electromagnetic waves just below visible light in frequency.",
                                imageUrl: "http://googleusercontent.com/file_content/4", // image_68fec8.png
                            },
                        ],
                    },
                ],
            },
            {
                id: 'osi-model',
                title: 'OSI Model',
                content: "The OSI (Open Systems Interconnection) model is a conceptual framework used to understand and standardize how different networking systems communicate with each other. It divides the communication process into seven layers, with each layer performing a specific function.",
                imageUrl: "http://googleusercontent.com/file_content/5", // image_68ff02.jpg
                subtopics: [
                    {
                        id: 'application-layer',
                        title: 'Application Layer',
                        content: "Provides network services directly to the user's application. Interface between software and network.",
                        imageUrl: "http://googleusercontent.com/file_content/6", // image_68ff26.jpg
                    },
                    {
                        id: 'presentation-layer',
                        title: 'Presentation Layer',
                        content: "Translates data into a format understandable by the application layer. Handles encryption, compression, and translation.",
                        imageUrl: "http://googleusercontent.com/file_content/6", // image_68ff26.jpg
                    },
                    {
                        id: 'session-layer',
                        title: 'Session Layer',
                        content: "Manages sessions between two applications (starting, maintaining, and ending them). Example: Keeping a video call active for the duration of a meeting.",
                        imageUrl: "http://googleusercontent.com/file_content/6", // image_68ff26.jpg
                    },
                    {
                        id: 'transport-layer',
                        title: 'Transport Layer',
                        content: "Provides end-to-end communication and reliability. Controls data flow, segmentation, and error recovery. (TCP and UDP)",
                        imageUrl: "http://googleusercontent.com/file_content/6", // image_68ff26.jpg
                    },
                    {
                        id: 'network-layer',
                        title: 'Network Layer',
                        content: "Manages routing of data between networks. Uses IP addresses to identify devices globally.",
                        imageUrl: "http://googleusercontent.com/file_content/7", // image_68ff5e.jpg
                    },
                    {
                        id: 'data-link-layer',
                        title: 'Data Link Layer',
                        content: "Ensures error-free communication between two devices on the same network (local). Framing and addressing. Error detection (not correction).",
                        imageUrl: "http://googleusercontent.com/file_content/7", // image_68ff5e.jpg
                    },
                    {
                        id: 'physical-layer',
                        title: 'Physical Layer',
                        content: "Transmits raw binary data (0s and 1s) over a physical medium. (Ethernet, Fiber Optics, Radio Waves)",
                        imageUrl: "http://googleusercontent.com/file_content/7", // image_68ff5e.jpg
                    },
                ],
            },
            {
                id: 'internetworks',
                title: 'Internetworks',
                content: "Refer to the practice and concept of connecting multiple different computer networks into a larger, unified system. The resulting system is often simply called an internetwork, a network of networks.",
                imageUrl: "http://googleusercontent.com/file_content/8", // image_68ff86.jpg
                subtopics: [
                    {
                        id: 'interoperability',
                        title: '1. Interoperability',
                        content: "Different networks and devices, possibly from different vendors or using different technologies, must be able to communicate seamlessly. Example: Your smartphone (using Wi-Fi) connects to your home router, which then connects to the Internet provider's network  even though these networks use different hardware and protocols internally.",
                        imageUrl: "http://googleusercontent.com/file_content/9", // image_690249.png
                    },
                    {
                        id: 'scalability',
                        title: '2. Scalability',
                        content: "The network should be able to grow easily, supporting more devices, users, or networks without performance degradation or redesign. Example: A company opens new branch offices in other cities, and their internal network smoothly connects to the existing network infrastructure without needing to rebuild everything from scratch.",
                        imageUrl: "http://googleusercontent.com/file_content/9", // image_690249.png
                    },
                    {
                        id: 'security-principles', // Renamed to avoid conflict with existing 'security' topic
                        title: '3. Security',
                        content: "Protecting data and networks from unauthorized access or attacks. Example: When you use online banking, your data is encrypted using protocols like HTTPS and VPN tunnels protect communication between bank branches to prevent hackers from intercepting sensitive information.",
                        imageUrl: "http://googleusercontent.com/file_content/9", // image_690249.png
                    },
                    {
                        id: 'efficiency',
                        title: '4. Efficiency',
                        content: "Data should be transmitted with minimal delay and minimal use of network resources.",
                        imageUrl: "http://googleusercontent.com/file_content/10", // image_69026c.png
                    },
                    {
                        id: 'routing-principles', // Renamed to avoid conflict with existing 'routing' concept
                        title: '5. Routing',
                        content: "Determining the best path for data packets to travel from source to destination across multiple networks.",
                        imageUrl: "http://googleusercontent.com/file_content/10", // image_69026c.png
                    },
                    {
                        id: 'addressing-principles', // Renamed to avoid conflict with existing 'addressing' concept
                        title: '6. Addressing',
                        content: "Each device in the internetwork must have a unique identifier (IP address) so data knows where to go.",
                        imageUrl: "http://googleusercontent.com/file_content/10", // image_69026c.png
                    },
                    {
                        id: 'standardized-protocols-principles', // Renamed to avoid conflict
                        title: '7. Standardized Protocols',
                        content: "All devices use common communication rules so they can understand each other.",
                        imageUrl: "http://googleusercontent.com/file_content/10", // image_69026c.png
                    },
                ],
            },
            {
                id: 'architecture',
                title: 'Architecture',
                content: "Internetworking architecture refers to the design and structure that enables multiple computer networks to communicate and function together as a unified system. The key goal is to allow seamless data communication across different network types and protocols.",
                imageUrl: "http://googleusercontent.com/file_content/11", // image_6911a7.png
                subtopics: [
                    {
                        id: 'architecture-osi-model',
                        title: '1. OSI Model',
                        content: "The OSI Model is a conceptual framework used to understand and standardize how different networking systems communicate with each other. It divides the communication process into seven layers, with each layer performing a specific function.",
                        // Note: This references the existing detailed OSI model topic.
                    },
                    {
                        id: 'architecture-tcp-ip',
                        title: '2. TCP/IP',
                        content: "TCP/IP (Transmission Control Protocol/Internet Protocol) is the fundamental protocol suite for internetworking and the internet. TCP handles reliable data delivery, while IP handles addressing and routing.",
                        // Note: This references the existing detailed TCP/IP concepts.
                    },
                    {
                        id: 'hybrid-architecture',
                        title: '3. Hybrid Architecture (Combination of OSI and TCP/IP)',
                        content: "Hybrid architectures combine elements from both the OSI and TCP/IP models, leveraging the strengths of each for specific networking needs.",
                    },
                    {
                        id: 'client-server-peer-to-peer',
                        title: '4. Client-Server and Peer-to-Peer Architectures',
                        content: `
                            <ul>
                                <li><strong>Client-Server:</strong> A centralized system where clients request services, and servers respond.</li>
                                <li><strong>Peer-to-Peer:</strong> A decentralized network where each device (peer) can act as both a client and a server.</li>
                            </ul>
                        `,
                        imageUrl: "http://googleusercontent.com/file_content/12", // image_6911ca.png
                    },
                    {
                        id: 'software-defined-networking-sdn',
                        title: '5. Software-Defined Networking (SDN) Architecture',
                        content: `
                            <p>SDN is a modern network architecture approach that separates the <strong>control plane</strong> (which makes decisions about where traffic is sent) from the <strong>data plane</strong> (which actually forwards traffic to the selected destination).</p>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">SDN Layers:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li><strong>Application Layer:</strong> Network monitoring tools, Firewalls</li>
                                <li><strong>Control Layer:</strong> Manages and controls network behavior by communicating with both apps and network devices.</li>
                                <li><strong>Infrastructure Layer / Data Plane:</strong> Switches, Routers</li>
                            </ul>
                        `,
                        imageUrl: "http://googleusercontent.com/file_content/13", // image_691204.png
                    },
                    {
                        id: 'cloud-networking-architecture',
                        title: '6. Cloud Networking Architecture',
                        content: "Cloud networking architecture refers to how networking resources and services are designed, deployed, and managed in cloud computing environments (AWS, Azure, or Google Cloud). It connects users to applications and services.",
                        imageUrl: "http://googleusercontent.com/file_content/14", // image_69122b.png
                    },
                    {
                        id: 'internet-of-things-iot',
                        title: '7. Internet of Things (IoT) Networking Architecture',
                        content: `
                            <p>The Internet of Things (IoT) Networking Architecture refers to the layered structure and components that enable billions of interconnected devices (like sensors, smart appliances, and vehicles) to collect, exchange, and act on data over the internet or local networks.</p>
                            <h5 class="font-semibold text-gray-800 mt-4 mb-2">IoT Architecture Layers:</h5>
                            <ul class="list-disc list-inside text-gray-700">
                                <li><strong>1. Perception Layer:</strong> Detects and collects data from the physical environment. Role: Converts physical signals (temperature, motion, etc.) into digital data.</li>
                                <li><strong>2. Network Layer:</strong> Transmits the data from the perception layer to the processing systems. Role: Provides secure, reliable communication between IoT devices and cloud or edge servers.</li>
                                <li><strong>3. Processing Layer:</strong> Filters, stores, and processes data; sometimes called the edge or fog layer when close to the devices. Role: Reduces load on cloud; makes fast, real-time decisions.</li>
                                <li><strong>4. Application Layer:</strong> Delivers services to users based on the processed data. Role: Interfaces with end-users and business logic.</li>
                            </ul>
                        `,
                        imageUrl: "http://googleusercontent.com/file_content/15", // image_691265.png
                    },
                ],
            },
        ];

        const quizData = [
            {
                question: "What is the primary purpose of a computer network?",
                options: [
                    "To store data offline",
                    "To share resources and exchange data",
                    "To run standalone applications",
                    "To print documents only"
                ],
                answer: "To share resources and exchange data"
            },
            {
                question: "Which of the following is NOT a type of computer network?",
                options: [
                    "LAN",
                    "WAN",
                    "MAN",
                    "PAN",
                    "CAN" // Correct option, as CAN is not typically a primary type like LAN, WAN, MAN, PAN
                ],
                answer: "CAN"
            },
            {
                question: "What does TCP/IP stand for?",
                options: [
                    "Transmission Control Protocol/Internet Protocol",
                    "Transfer Control Point/Internet Packet",
                    "Technical Communication Process/Internal Protocol",
                    "Total Control Program/Internet Provider"
                ],
                answer: "Transmission Control Protocol/Internet Protocol"
            },
            {
                question: "Which protocol is used for securely accessing websites?",
                options: [
                    "HTTP",
                    "FTP",
                    "HTTPS",
                    "SMTP"
                ],
                answer: "HTTPS"
            },
            {
                question: "In which topology does a single long cable act as a backbone to link all devices?",
                options: [
                    "Star Topology",
                    "Ring Topology",
                    "Bus Topology",
                    "Mesh Topology"
                ],
                answer: "Bus Topology"
            },
            {
                question: "Which device connects multiple devices within a Local Area Network (LAN)?",
                options: [
                    "Modem",
                    "Router",
                    "Switch",
                    "Firewall"
                ],
                answer: "Switch"
            },
            {
                question: "What is the main function of DNS?",
                options: [
                    "To assign IP addresses automatically",
                    "To transfer files between computers",
                    "To translate domain names into IP addresses",
                    "To secure IP communications"
                ],
                answer: "To translate domain names into IP addresses"
            },
            {
                question: "Which of these is a standard for wireless LAN communication?",
                options: [
                    "IEEE 802.3",
                    "MPLS",
                    "IEEE 802.11",
                    "HDLC"
                ],
                answer: "IEEE 802.11"
            },
            {
                question: "What was a significant development in computer networks during the 1990s?",
                options: [
                    "Introduction of ARPANET",
                    "Rise of 5G mobile networks",
                    "Invention of the World Wide Web",
                    "Development of SAGE"
                ],
                answer: "Invention of the World Wide Web"
            },
            {
                question: "Which protocol is used for sending email?",
                options: [
                    "POP3",
                    "IMAP",
                    "SMTP",
                    "All of the above"
                ],
                answer: "All of the above"
            },
            // New quiz questions based on the new topics
            {
                question: "Which type of transmission media transmits data through air or space using electromagnetic waves?",
                options: [
                    "Twisted Pair Cable",
                    "Coaxial Cable",
                    "Fiber Optic Cable",
                    "Unguided Media"
                ],
                answer: "Unguided Media"
            },
            {
                question: "What is the primary use of Unshielded Twisted Pair (UTP) cables?",
                options: [
                    "Long-distance, high-speed connections",
                    "Environments with high interference",
                    "Ethernet networks (LAN)",
                    "CCTV systems"
                ],
                answer: "Ethernet networks (LAN)"
            },
            {
                question: "How many layers are in the OSI Model?",
                options: [
                    "5",
                    "6",
                    "7",
                    "8"
                ],
                answer: "7"
            },
            {
                question: "Which OSI layer is responsible for managing sessions between two applications?",
                options: [
                    "Application Layer",
                    "Presentation Layer",
                    "Session Layer",
                    "Transport Layer"
                ],
                answer: "Session Layer"
            },
            {
                question: "What is the main principle of 'Interoperability' in internetworking?",
                options: [
                    "The network should be able to grow easily.",
                    "Protecting data from unauthorized access.",
                    "Different networks and devices must be able to communicate seamlessly.",
                    "Data should be transmitted with minimal delay."
                ],
                answer: "Different networks and devices must be able to communicate seamlessly."
            },
            {
                question: "Which architecture separates the control plane from the data plane?",
                options: [
                    "Client-Server Architecture",
                    "Peer-to-Peer Architecture",
                    "Hybrid Architecture",
                    "Software-Defined Networking (SDN) Architecture"
                ],
                answer: "Software-Defined Networking (SDN) Architecture"
            },
            {
                question: "In Cloud Networking Architecture, what is the primary goal?",
                options: [
                    "To manage sessions between applications.",
                    "To connect users to applications and services in cloud environments.",
                    "To transmit raw binary data over a physical medium.",
                    "To translate domain names into IP addresses."
                ],
                answer: "To connect users to applications and services in cloud environments."
            },
            {
                question: "Which layer of IoT Architecture is responsible for converting physical signals into digital data?",
                options: [
                    "Network Layer",
                    "Processing Layer",
                    "Perception Layer",
                    "Application Layer"
                ],
                answer: "Perception Layer"
            },
            {
                question: "Which type of architecture features a centralized system where clients request services and servers respond?",
                options: [
                    "Peer-to-Peer Architecture",
                    "Client-Server Architecture",
                    "Hybrid Architecture",
                    "SDN Architecture"
                ],
                answer: "Client-Server Architecture"
            },
            {
                question: "What is the role of the Processing Layer in IoT Architecture?",
                options: [
                    "Detects and collects data from the physical environment.",
                    "Transmits data from the perception layer to processing systems.",
                    "Filters, stores, and processes data, making real-time decisions.",
                    "Delivers services to users based on processed data."
                ],
                answer: "Filters, stores, and processes data, making real-time decisions."
            }
        ];

        const flashcardsData = [
            {
                question: "What is a computer network?",
                answer: "A group of interconnected computers and devices sharing resources and data."
            },
            {
                question: "What is a LAN?",
                answer: "Local Area Network, covering a small geographical area."
            },
            {
                question: "What is a WAN?",
                answer: "Wide Area Network, covering a large geographical area."
            },
            {
                question: "What is the purpose of a Router?",
                answer: "Connects LANs to other networks or the internet."
            },
            {
                question: "What does HTTP stand for?",
                answer: "HyperText Transfer Protocol, used for accessing websites."
            },
            {
                question: "What is a Bus Topology?",
                answer: "A network where all devices are connected to a single long cable (backbone)."
            },
            {
                question: "What is a Star Topology?",
                answer: "A network where each device connects to a central hub."
            },
            {
                question: "What is the function of DHCP?",
                answer: "Automatically assigns IP addresses to devices on a network."
            },
            {
                question: "What is an Extranet?",
                answer: "A private network allowing authorized external users to access parts of an organization's intranet."
            },
            {
                question: "What is the IEEE 802.11 standard for?",
                answer: "Wireless LAN (Wi-Fi) communication."
            },
            // New flashcards based on the new topics
            {
                question: "What are the two main categories of Transmission Media?",
                answer: "Guided (wired) and Unguided (wireless)."
            },
            {
                question: "Name a common type of Guided Media cable.",
                answer: "Twisted Pair Cable, Coaxial Cable, or Fiber Optic Cable."
            },
            {
                question: "What signal type is used by Fiber Optic Cables?",
                answer: "Light Signal."
            },
            {
                question: "What are Microwaves used for in Unguided Media?",
                answer: "High-frequency radio waves used for line-of-sight communication."
            },
            {
                question: "How many layers are there in the OSI Model?",
                answer: "Seven."
            },
            {
                question: "Which OSI layer ensures error-free communication on a local network?",
                answer: "Data Link Layer."
            },
            {
                question: "What is the purpose of the Network Layer in the OSI Model?",
                answer: "Manages routing of data between networks using IP addresses."
            },
            {
                question: "What is an 'Internetwork'?",
                answer: "Connecting multiple different computer networks into a larger, unified system (a network of networks)."
            },
            {
                question: "What does 'Scalability' mean in Internetworking principles?",
                answer: "The network should be able to grow easily, supporting more devices/users without performance degradation."
            },
            {
                question: "What is 'Routing' in the context of Internetworking principles?",
                answer: "Determining the best path for data packets to travel from source to destination across multiple networks."
            },
            {
                question: "What is 'Architecture' in internetworking?",
                answer: "The design and structure that enables multiple computer networks to communicate and function together as a unified system."
            },
            {
                question: "What is the key difference between Client-Server and Peer-to-Peer architectures?",
                answer: "Client-Server is centralized (clients request, servers respond), while Peer-to-Peer is decentralized (each device can be client and server)."
            },
            {
                question: "What does SDN stand for?",
                answer: "Software-Defined Networking."
            },
            {
                question: "Which SDN layer makes decisions about where traffic is sent?",
                answer: "Control Plane (or Control Layer)."
            },
            {
                question: "What is Cloud Networking Architecture about?",
                answer: "How networking resources and services are designed, deployed, and managed in cloud computing environments (e.g., AWS, Azure, Google Cloud)."
            },
            {
                question: "What does IoT stand for in networking?",
                answer: "Internet of Things."
            },
            {
                question: "Which IoT architecture layer collects data from the physical environment?",
                answer: "Perception Layer."
            },
            {
                question: "What is the role of the Network Layer in IoT Architecture?",
                answer: "Transmits data from the perception layer to processing systems, providing secure, reliable communication."
            }
        ];


        // --- Utility Functions ---
        function showMessage(title, message) {
            const modalOverlay = document.getElementById('messageModalOverlay');
            const modalTitle = document.getElementById('messageModalTitle');
            const modalMessage = document.getElementById('messageModalMessage');

            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalOverlay.classList.add('active');
            window.appState.messageModal.isVisible = true; // Update state
        }

        function hideMessage() {
            const modalOverlay = document.getElementById('messageModalOverlay');
            modalOverlay.classList.remove('active');
            window.appState.messageModal.isVisible = false; // Update state
        }

        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(`${screenId}Screen`).classList.add('active');
            window.appState.currentScreen = screenId; // Update state

            // Close sidebar on mobile after screen change
            const sidebar = document.getElementById('sidebar');
            if (sidebar.classList.contains('collapsed')) {
                sidebar.classList.remove('collapsed');
            }
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.dataset.screen === screenId) {
                    item.classList.add('bg-blue-600');
                } else {
                    item.classList.remove('bg-blue-600');
                }
            });

            // Specific screen setup on show
            if (screenId === 'dashboard') {
                updateDashboardUI();
            } else if (screenId === 'topics') {
                renderTopicsList();
            } else if (screenId === 'quiz') {
                resetQuiz();
            } else if (screenId === 'flashcards') {
                resetFlashcards();
            } else if (screenId === 'community') {
                renderCommunityQuestions();
            } else if (screenId === 'study-plan') {
                renderStudyPlan();
            } else if (screenId === 'progress') {
                renderProgressReport();
            }
        }

        // --- Firebase & Data Management ---
        async function updateUserData(newData) {
            if (window.appState.userId) {
                const userDocRef = doc(db, `artifacts/${appId}/users/${window.appState.userId}/profile`, 'userProfile');
                try {
                    await updateDoc(userDocRef, newData);
                    // Optimistically update local state; onSnapshot will confirm
                    window.appState.userData = { ...window.appState.userData, ...newData };
                    updateAllUI(); // Re-render relevant UI
                } catch (error) {
                    console.error("Error updating user data:", error);
                    showMessage("Error", "Failed to update user data. Please try again.");
                }
            } else {
                console.warn("User ID not available for updating data.");
            }
        }

        async function addCommunityQuestion(questionText) {
            if (!window.appState.userId) {
                showMessage("Error", "You must be logged in to post a question.");
                return;
            }
            if (!questionText.trim()) {
                showMessage("Error", "Question cannot be empty.");
                return;
            }
            try {
                await addDoc(collection(db, `artifacts/${appId}/public/data/communityQuestions`), {
                    userId: window.appState.userId,
                    question: questionText.trim(),
                    timestamp: new Date().toISOString(),
                });
                document.getElementById('newQuestionText').value = ''; // Clear input
                showMessage("Success", "Your question has been posted to the community!");
            } catch (error) {
                console.error("Error adding community question:", error);
                showMessage("Error", "Failed to post question. Please try again.");
            }
        }

        async function addStudyPlanItem(itemText) {
            if (!window.appState.userId) {
                showMessage("Error", "You must be logged in to add study plan items.");
                return;
            }
            if (!itemText.trim()) {
                showMessage("Error", "Study plan item cannot be empty.");
                return;
            }

            const currentPlan = window.appState.userData.studyPlan || {};
            const newPlan = { ...currentPlan };
            const itemId = `item-${Date.now()}`; // Simple unique ID
            newPlan[itemId] = { text: itemText.trim(), completed: false, timestamp: new Date().toISOString() };

            await updateUserData({ studyPlan: newPlan });
            document.getElementById('newStudyPlanItem').value = ''; // Clear input
        }

        async function toggleStudyPlanItemCompletion(itemId) {
            if (!window.appState.userId) return;

            const currentPlan = window.appState.userData.studyPlan || {};
            const item = currentPlan[itemId];
            if (item) {
                const newPlan = { ...currentPlan, [itemId]: { ...item, completed: !item.completed } };
                await updateUserData({ studyPlan: newPlan });
            }
        }

        async function deleteStudyPlanItem(itemId) {
            if (!window.appState.userId) return;

            const currentPlan = window.appState.userData.studyPlan || {};
            const newPlan = { ...currentPlan };
            delete newPlan[itemId];
            await updateUserData({ studyPlan: newPlan });
        }


        // --- UI Update Functions ---
        function updateAllUI() {
            updateDashboardUI();
            renderTopicsList(); // Re-render topics to show completion status
            renderCommunityQuestions();
            renderStudyPlan();
            renderProgressReport();
            // Quiz and Flashcards are reset/rendered when their screens are activated
        }

        function updateDashboardUI() {
            const userData = window.appState.userData;
            document.getElementById('dashboardPoints').textContent = userData.points || 0;
            document.getElementById('dashboardCompletedTopics').textContent = (userData.completedTopics || []).length;

            const quizScores = userData.quizScores || {};
            const latestQuizKey = Object.keys(quizScores).sort().pop(); // Get latest quiz by key (timestamp)
            if (latestQuizKey) {
                const latestScore = quizScores[latestQuizKey].score;
                const latestTotal = quizScores[latestQuizKey].totalQuestions;
                document.getElementById('dashboardLatestQuizScore').textContent = `${latestScore}/${latestTotal}`;
            } else {
                document.getElementById('dashboardLatestQuizScore').textContent = 'N/A';
            }
            document.getElementById('displayUserId').textContent = window.appState.userId || 'Guest';
        }

        function renderTopicsList() {
            const topicListElement = document.getElementById('topicList');
            topicListElement.innerHTML = ''; // Clear existing list
            const completedTopics = window.appState.userData.completedTopics || [];

            topicsData.forEach(topic => {
                const isTopicCompleted = completedTopics.includes(topic.id);
                const li = document.createElement('li');
                li.className = 'mb-2';
                li.innerHTML = `
                    <a href="#" class="topic-item flex items-center p-3 rounded-lg hover:bg-blue-100 transition duration-200 ${isTopicCompleted ? 'bg-green-100 text-green-800' : 'text-gray-800'}" data-topic-id="${topic.id}">
                        <svg class="w-5 h-5 mr-3 ${isTopicCompleted ? 'text-green-600' : 'text-blue-500'}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.206 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.794 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.794 5 16.5 5c1.706 0 3.332.477 4.5 1.253v13C19.832 18.477 18.206 18 16.5 18c-1.706 0-3.332.477-4.5 1.253"></path></svg>
                        ${topic.title}
                        ${isTopicCompleted ? '<svg class="w-5 h-5 ml-auto text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' : ''}
                    </a>
                `;
                topicListElement.appendChild(li);

                if (topic.subtopics) {
                    const ulSub = document.createElement('ul');
                    ulSub.className = 'ml-6 border-l border-gray-200';
                    topic.subtopics.forEach(subtopic => {
                        const isSubtopicCompleted = completedTopics.includes(subtopic.id);
                        const liSub = document.createElement('li');
                        liSub.className = 'mb-1';
                        liSub.innerHTML = `
                            <a href="#" class="topic-item flex items-center p-2 rounded-lg hover:bg-blue-50 transition duration-200 ${isSubtopicCompleted ? 'bg-green-50 text-green-700' : 'text-gray-700'}" data-topic-id="${subtopic.id}">
                                <svg class="w-4 h-4 mr-2 ${isSubtopicCompleted ? 'text-green-500' : 'text-blue-400'}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M.636 17.364l.707-.707M12 21v-1m-6.364-1.636l.707-.707M3 12H2m18 0h-1M16.5 12a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"></path></svg>
                                ${subtopic.title}
                                ${isSubtopicCompleted ? '<svg class="w-4 h-4 ml-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' : ''}
                            </a>
                        `;
                        ulSub.appendChild(liSub);
                    });
                    li.appendChild(ulSub);
                }
            });

            // Add event listeners to newly created topic items
            document.querySelectorAll('.topic-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const topicId = e.currentTarget.dataset.topicId;
                    displayTopicContent(topicId);
                    // Remove active class from all, add to current
                    document.querySelectorAll('.topic-item').forEach(el => el.classList.remove('bg-blue-100', 'font-semibold'));
                    e.currentTarget.classList.add('bg-blue-100', 'font-semibold');
                });
            });
        }

        function displayTopicContent(topicId) {
            let selectedTopic = null;
            for (const topic of topicsData) {
                if (topic.id === topicId) {
                    selectedTopic = topic;
                    break;
                }
                if (topic.subtopics) {
                    const sub = topic.subtopics.find(sub => sub.id === topicId);
                    if (sub) {
                        selectedTopic = sub;
                        break;
                    }
                }
            }

            const titleElement = document.getElementById('currentTopicTitle');
            const bodyElement = document.getElementById('currentTopicBody');
            const imageElement = document.getElementById('currentTopicImage');
            const markCompleteBtn = document.getElementById('markTopicCompleteBtn');

            if (selectedTopic) {
                titleElement.textContent = selectedTopic.title;
                bodyElement.innerHTML = selectedTopic.content || '<p>No content available for this topic.</p>';

                if (selectedTopic.type === 'table' && selectedTopic.data) {
                    let tableHtml = '<table class="min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden shadow-sm">';
                    selectedTopic.data.forEach((row, index) => {
                        tableHtml += index === 0 ? '<thead class="bg-gray-50"><tr>' : '<tbody class="bg-white divide-y divide-gray-200"><tr>';
                        row.forEach(cell => {
                            tableHtml += index === 0 ? `<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${cell}</th>` : `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${cell}</td>`;
                        });
                        tableHtml += index === 0 ? '</tr></thead>' : '</tr>';
                    });
                    tableHtml += '</tbody></table>';
                    bodyElement.innerHTML = tableHtml;
                }

                if (selectedTopic.imageUrl) {
                    imageElement.src = selectedTopic.imageUrl;
                    imageElement.classList.remove('hidden');
                } else {
                    imageElement.classList.add('hidden');
                    imageElement.src = ''; // Clear src to prevent broken image icon
                }

                // Mark as complete button logic
                markCompleteBtn.classList.remove('hidden');
                const isCompleted = (window.appState.userData.completedTopics || []).includes(selectedTopic.id);
                if (isCompleted) {
                    markCompleteBtn.textContent = 'Topic Completed!';
                    markCompleteBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                    markCompleteBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                    markCompleteBtn.disabled = true;
                } else {
                    markCompleteBtn.textContent = 'Mark as Completed';
                    markCompleteBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    markCompleteBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                    markCompleteBtn.disabled = false;
                    markCompleteBtn.onclick = async () => {
                        const currentCompleted = new Set(window.appState.userData.completedTopics || []);
                        currentCompleted.add(selectedTopic.id);
                        await updateUserData({ completedTopics: Array.from(currentCompleted), points: (window.appState.userData.points || 0) + 10 }); // Award 10 points
                        showMessage("Success", `You earned 10 points for completing "${selectedTopic.title}"!`);
                        renderTopicsList(); // Re-render list to show checkmark
                        displayTopicContent(selectedTopic.id); // Re-render current content to update button
                    };
                }
            } else {
                titleElement.textContent = "Topic Not Found";
                bodyElement.innerHTML = "<p>The selected topic could not be found.</p>";
                imageElement.classList.add('hidden');
                markCompleteBtn.classList.add('hidden');
            }
        }

        // --- Quiz Logic ---
        function resetQuiz() {
            window.appState.quiz = {
                currentQuestionIndex: 0,
                selectedAnswer: null,
                isAnswered: false,
                score: 0,
                timer: null,
                timeLeft: 60,
                quizQuestions: [...quizData].sort(() => Math.random() - 0.5).slice(0, 10), // Shuffle and take 10
            };
            document.getElementById('quizStartScreen').classList.remove('hidden');
            document.getElementById('quizQuestionScreen').classList.add('hidden');
            document.getElementById('quizResultScreen').classList.add('hidden');
            document.getElementById('submitQuizBtn').classList.add('hidden');
            document.getElementById('nextQuestionBtn').textContent = 'Next';
            document.getElementById('nextQuestionBtn').classList.remove('bg-green-600', 'hover:bg-green-700');
            document.getElementById('nextQuestionBtn').classList.add('bg-blue-600', 'hover:bg-blue-700');
        }

        function startQuiz() {
            document.getElementById('quizStartScreen').classList.add('hidden');
            document.getElementById('quizQuestionScreen').classList.remove('hidden');
            loadQuizQuestion();
            startQuizTimer();
        }

        function startQuizTimer() {
            clearInterval(window.appState.quiz.timer);
            window.appState.quiz.timeLeft = 60; // Reset timer for each question
            document.getElementById('quizTimer').textContent = formatTime(window.appState.quiz.timeLeft);

            window.appState.quiz.timer = setInterval(() => {
                window.appState.quiz.timeLeft--;
                document.getElementById('quizTimer').textContent = formatTime(window.appState.quiz.timeLeft);
                if (window.appState.quiz.timeLeft <= 0) {
                    clearInterval(window.appState.quiz.timer);
                    // Automatically move to next question if time runs out and not answered
                    if (!window.appState.quiz.isAnswered) {
                         // Mark current question as incorrect if not answered
                        const currentQuestion = window.appState.quiz.quizQuestions[window.appState.quiz.currentQuestionIndex];
                        if (currentQuestion) {
                            // Simulate selecting an incorrect answer to show feedback
                            const optionsContainer = document.getElementById('quizOptionsContainer');
                            const correctOptionElement = Array.from(optionsContainer.children).find(opt => opt.dataset.option === currentQuestion.answer);
                            if (correctOptionElement) {
                                correctOptionElement.classList.add('correct');
                            }
                            // No selected answer, so no 'incorrect' class for a chosen option
                            // Just proceed
                        }
                        window.appState.quiz.isAnswered = true; // Prevent multiple submissions
                        setTimeout(moveToNextQuestion, 1000); // Give a moment to see feedback
                    } else {
                        moveToNextQuestion(); // If already answered, just move on
                    }
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function loadQuizQuestion() {
            const quizState = window.appState.quiz;
            const currentQuestion = quizState.quizQuestions[quizState.currentQuestionIndex];

            if (!currentQuestion) {
                submitQuiz();
                return;
            }

            document.getElementById('currentQuestionNumber').textContent = quizState.currentQuestionIndex + 1;
            document.getElementById('totalQuestions').textContent = quizState.quizQuestions.length;
            document.getElementById('quizQuestionText').textContent = currentQuestion.question;

            const optionsContainer = document.getElementById('quizOptionsContainer');
            optionsContainer.innerHTML = '';
            currentQuestion.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'quiz-option p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-100 transition duration-200';
                optionDiv.textContent = option;
                optionDiv.dataset.option = option;
                optionDiv.addEventListener('click', () => selectQuizOption(optionDiv, option));
                optionsContainer.appendChild(optionDiv);
            });

            quizState.selectedAnswer = null;
            quizState.isAnswered = false;
            clearInterval(quizState.timer); // Clear timer for previous question
            startQuizTimer(); // Start timer for new question

            // Update navigation buttons
            document.getElementById('prevQuestionBtn').disabled = quizState.currentQuestionIndex === 0;
            document.getElementById('nextQuestionBtn').disabled = false; // Enable next by default
            document.getElementById('nextQuestionBtn').textContent = 'Next';
            document.getElementById('nextQuestionBtn').classList.remove('bg-green-600', 'hover:bg-green-700');
            document.getElementById('nextQuestionBtn').classList.add('bg-blue-600', 'hover:bg-blue-700');
            document.getElementById('submitQuizBtn').classList.add('hidden'); // Hide submit until last question
        }

        function selectQuizOption(selectedOptionElement, selectedOption) {
            const quizState = window.appState.quiz;
            if (quizState.isAnswered) return; // Prevent changing answer after submission

            quizState.selectedAnswer = selectedOption;

            // Remove selected/correct/incorrect classes from all options
            const options = document.querySelectorAll('#quizOptionsContainer .quiz-option');
            options.forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });

            // Add selected class to the clicked option
            selectedOptionElement.classList.add('selected');

            // Check answer and provide feedback
            const currentQuestion = quizState.quizQuestions[quizState.currentQuestionIndex];
            if (selectedOption === currentQuestion.answer) {
                selectedOptionElement.classList.add('correct');
                quizState.score++;
            } else {
                selectedOptionElement.classList.add('incorrect');
                // Highlight correct answer
                const correctOptionElement = Array.from(options).find(opt => opt.dataset.option === currentQuestion.answer);
                if (correctOptionElement) {
                    correctOptionElement.classList.add('correct');
                }
            }
            quizState.isAnswered = true;
            clearInterval(quizState.timer); // Stop timer once answered

            // Disable all options after answering
            options.forEach(opt => opt.classList.add('disabled'));

            // If it's the last question, change Next button to Submit
            if (quizState.currentQuestionIndex === quizState.quizQuestions.length - 1) {
                document.getElementById('nextQuestionBtn').classList.add('hidden');
                document.getElementById('submitQuizBtn').classList.remove('hidden');
            }
        }

        function moveToNextQuestion() {
            const quizState = window.appState.quiz;
            if (quizState.currentQuestionIndex < quizState.quizQuestions.length - 1) {
                quizState.currentQuestionIndex++;
                loadQuizQuestion();
            } else {
                submitQuiz();
            }
        }

        function moveToPrevQuestion() {
            const quizState = window.appState.quiz;
            if (quizState.currentQuestionIndex > 0) {
                quizState.currentQuestionIndex--;
                loadQuizQuestion(); // This will reset timer and options
            }
        }

        async function submitQuiz() {
            clearInterval(window.appState.quiz.timer); // Ensure timer is stopped
            document.getElementById('quizQuestionScreen').classList.add('hidden');
            document.getElementById('quizResultScreen').classList.remove('hidden');

            const quizState = window.appState.quiz;
            document.getElementById('quizScore').textContent = quizState.score;
            document.getElementById('quizTotalQuestions').textContent = quizState.quizQuestions.length;

            const pointsEarned = quizState.score * 5; // Example: 5 points per correct answer
            document.getElementById('quizPointsEarned').textContent = pointsEarned;

            // Update user data in Firestore
            const newQuizScore = {
                score: quizState.score,
                totalQuestions: quizState.quizQuestions.length,
                timestamp: new Date().toISOString(),
            };

            const updatedQuizScores = { ...window.appState.userData.quizScores, [newQuizScore.timestamp]: newQuizScore };
            await updateUserData({
                points: (window.appState.userData.points || 0) + pointsEarned,
                quizScores: updatedQuizScores,
            });
        }

        // --- Flashcards Logic ---
        function resetFlashcards() {
            window.appState.flashcards = {
                currentFlashcardIndex: 0,
                isFlipped: false,
                flashcardData: [...flashcardsData].sort(() => Math.random() - 0.5), // Shuffle flashcards
            };
            document.getElementById('flashcardQuestion').textContent = "Click 'Start Flashcards' to begin!";
            document.getElementById('flashcardAnswer').textContent = "";
            document.getElementById('flashcard').classList.remove('flipped');
            document.getElementById('startFlashcardsBtn').classList.remove('hidden');
            document.getElementById('prevFlashcardBtn').disabled = true;
            document.getElementById('nextFlashcardBtn').disabled = true;
            document.getElementById('flipFlashcardBtn').disabled = true;
        }

        function startFlashcards() {
            document.getElementById('startFlashcardsBtn').classList.add('hidden');
            loadFlashcard();
            document.getElementById('prevFlashcardBtn').disabled = true; // First card, so prev is disabled
            document.getElementById('nextFlashcardBtn').disabled = false;
            document.getElementById('flipFlashcardBtn').disabled = false;
        }

        function loadFlashcard() {
            const flashcardsState = window.appState.flashcards;
            const currentCard = flashcardsState.flashcardData[flashcardsState.currentFlashcardIndex];

            if (currentCard) {
                document.getElementById('flashcardQuestion').textContent = currentCard.question;
                document.getElementById('flashcardAnswer').textContent = currentCard.answer;
                document.getElementById('flashcard').classList.remove('flipped'); // Ensure it's showing front
                flashcardsState.isFlipped = false;
            } else {
                document.getElementById('flashcardQuestion').textContent = "No more flashcards!";
                document.getElementById('flashcardAnswer').textContent = "";
                document.getElementById('prevFlashcardBtn').disabled = true;
                document.getElementById('nextFlashcardBtn').disabled = true;
                document.getElementById('flipFlashcardBtn').disabled = true;
            }
            updateFlashcardNavButtons();
        }

        function flipFlashcard() {
            const flashcardElement = document.getElementById('flashcard');
            flashcardElement.classList.toggle('flipped');
            window.appState.flashcards.isFlipped = !window.appState.flashcards.isFlipped;
        }

        function nextFlashcard() {
            const flashcardsState = window.appState.flashcards;
            if (flashcardsState.currentFlashcardIndex < flashcardsState.flashcardData.length - 1) {
                flashcardsState.currentFlashcardIndex++;
                loadFlashcard();
            }
        }

        function prevFlashcard() {
            const flashcardsState = window.appState.flashcards;
            if (flashcardsState.currentFlashcardIndex > 0) {
                flashcardsState.currentFlashcardIndex--;
                loadFlashcard();
            }
        }

        function updateFlashcardNavButtons() {
            const flashcardsState = window.appState.flashcards;
            document.getElementById('prevFlashcardBtn').disabled = flashcardsState.currentFlashcardIndex === 0;
            document.getElementById('nextFlashcardBtn').disabled = flashcardsState.currentFlashcardIndex === flashcardsState.flashcardData.length - 1;
            document.getElementById('flipFlashcardBtn').disabled = flashcardsState.flashcardData.length === 0;
        }

        // --- Community Screen UI ---
        function renderCommunityQuestions() {
            const questionsList = document.getElementById('communityQuestionsList');
            questionsList.innerHTML = ''; // Clear existing questions
            const noQuestionsMessage = document.getElementById('noCommunityQuestions');

            if (window.appState.questions.length === 0) {
                noQuestionsMessage.classList.remove('hidden');
            } else {
                noQuestionsMessage.classList.add('hidden');
                // Sort by timestamp descending
                const sortedQuestions = [...window.appState.questions].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                sortedQuestions.forEach(q => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200';
                    questionDiv.innerHTML = `
                        <p class="text-gray-800 text-lg mb-2">${q.question}</p>
                        <p class="text-sm text-gray-500">Asked by User ID: <span class="font-mono break-all">${q.userId}</span> on ${new Date(q.timestamp).toLocaleDateString()} at ${new Date(q.timestamp).toLocaleTimeString()}</p>
                    `;
                    questionsList.appendChild(questionDiv);
                });
            }
        }

        // --- Study Plan UI ---
        function renderStudyPlan() {
            const studyPlanList = document.getElementById('studyPlanList');
            studyPlanList.innerHTML = ''; // Clear existing items
            const noItemsMessage = document.getElementById('noStudyPlanItems');

            const studyPlanItems = Object.entries(window.appState.userData.studyPlan || {}).map(([id, item]) => ({ id, ...item }));

            if (studyPlanItems.length === 0) {
                noItemsMessage.classList.remove('hidden');
            } else {
                noItemsMessage.classList.add('hidden');
                // Sort by timestamp descending
                studyPlanItems.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                studyPlanItems.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `flex items-center justify-between p-3 rounded-lg shadow-sm ${item.completed ? 'bg-green-50' : 'bg-blue-50'} border ${item.completed ? 'border-green-200' : 'border-blue-200'}`;
                    itemDiv.innerHTML = `
                        <div class="flex items-center flex-grow">
                            <input type="checkbox" id="studyPlanItem-${item.id}" class="form-checkbox h-5 w-5 text-blue-600 rounded" ${item.completed ? 'checked' : ''}>
                            <label for="studyPlanItem-${item.id}" class="ml-3 text-lg ${item.completed ? 'line-through text-gray-500' : 'text-gray-800'}">${item.text}</label>
                        </div>
                        <button class="delete-study-item-btn text-red-500 hover:text-red-700 ml-4" data-item-id="${item.id}">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    `;
                    studyPlanList.appendChild(itemDiv);

                    // Add event listeners
                    itemDiv.querySelector(`#studyPlanItem-${item.id}`).addEventListener('change', () => toggleStudyPlanItemCompletion(item.id));
                    itemDiv.querySelector(`.delete-study-item-btn`).addEventListener('click', () => deleteStudyPlanItem(item.id));
                });
            }
        }

        // --- Progress Report UI ---
        function renderProgressReport() {
            const userData = window.appState.userData;

            document.getElementById('progressPoints').textContent = userData.points || 0;

            const completedTopicsList = document.getElementById('progressCompletedTopics');
            completedTopicsList.innerHTML = '';
            const noCompletedTopicsMessage = document.getElementById('noProgressCompletedTopics');

            if ((userData.completedTopics || []).length === 0) {
                noCompletedTopicsMessage.classList.remove('hidden');
            } else {
                noCompletedTopicsMessage.classList.add('hidden');
                (userData.completedTopics || []).forEach(topicId => {
                    const topic = topicsData.find(t => t.id === topicId) ||
                                  topicsData.flatMap(t => t.subtopics || []).find(st => st.id === topicId);
                    if (topic) {
                        const li = document.createElement('li');
                        li.textContent = topic.title;
                        completedTopicsList.appendChild(li);
                    }
                });
            }

            const quizHistoryList = document.getElementById('progressQuizHistory');
            quizHistoryList.innerHTML = '';
            const noQuizHistoryMessage = document.getElementById('noProgressQuizHistory');

            const quizScores = Object.entries(userData.quizScores || {}).map(([key, score]) => ({ key, ...score }));
            if (quizScores.length === 0) {
                noQuizHistoryMessage.classList.remove('hidden');
            } else {
                noQuizHistoryMessage.classList.add('hidden');
                quizScores.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)); // Latest first

                quizScores.forEach(score => {
                    const scoreDiv = document.createElement('div');
                    scoreDiv.className = 'bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200';
                    scoreDiv.innerHTML = `
                        <p class="text-lg font-medium text-gray-800">Score: ${score.score} / ${score.totalQuestions}</p>
                        <p class="text-sm text-gray-600">Date: ${new Date(score.timestamp).toLocaleDateString()} at ${new Date(score.timestamp).toLocaleTimeString()}</p>
                    `;
                    quizHistoryList.appendChild(scoreDiv);
                });
            }
        }


        // --- Event Listeners and Initial Setup ---
        document.addEventListener('DOMContentLoaded', async () => {
            // Firebase Auth Listener
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    window.appState.userId = user.uid;
                } else {
                    try {
                        // Use a dummy token for local development if __initial_auth_token is not defined
                        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : "dummy-token-for-local-dev";
                        if (initialAuthToken !== "dummy-token-for-local-dev") { // Only use custom token if it's a real one
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            // Fallback to anonymous sign-in for local dev if no real token
                            await signInAnonymously(auth);
                        }
                        window.appState.userId = auth.currentUser.uid;
                    } catch (error) {
                        console.error("Error signing in:", error);
                        window.appState.userId = crypto.randomUUID(); // Fallback to a random ID if sign-in fails
                        showMessage("Authentication Error", "Failed to sign in. You might not be able to save progress.");
                    }
                }
                window.appState.isAuthReady = true;
                document.getElementById('displayUserId').textContent = window.appState.userId;
                console.log("Auth ready, userId:", window.appState.userId);

                // Fetch user data and questions once authenticated
                if (window.appState.isAuthReady && window.appState.userId) {
                    // Fetch user data
                    const userDocRef = doc(db, `artifacts/${appId}/users/${window.appState.userId}/profile`, 'userProfile');
                    onSnapshot(userDocRef, (docSnap) => {
                        if (docSnap.exists()) {
                            window.appState.userData = docSnap.data();
                            console.log("User data loaded:", window.appState.userData);
                        } else {
                            // Create a default profile if it doesn't exist
                            setDoc(userDocRef, window.appState.userData); // Use initial state as default
                            console.log("New user profile created.");
                        }
                        updateAllUI(); // Initial UI render after user data is ready
                    }, (error) => console.error("Error fetching user data:", error));

                    // Fetch community questions
                    const q = query(collection(db, `artifacts/${appId}/public/data/communityQuestions`));
                    onSnapshot(q, (snapshot) => {
                        window.appState.questions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        console.log("Community questions loaded:", window.appState.questions);
                        renderCommunityQuestions(); // Update community screen
                    }, (error) => console.error("Error fetching questions:", error));
                }
            });

            // Navigation event listeners
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    showScreen(e.currentTarget.dataset.screen);
                });
            });

            // Message Modal Close Button
            document.getElementById('messageModalCloseBtn').addEventListener('click', hideMessage);

            // Sidebar Toggle for Mobile
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const mobileSidebarToggle = document.getElementById('mobileSidebarToggle');

            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
            });
            mobileSidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
            });

            // --- Quiz Screen Event Listeners ---
            document.getElementById('startQuizBtn').addEventListener('click', startQuiz);
            document.getElementById('nextQuestionBtn').addEventListener('click', moveToNextQuestion);
            document.getElementById('prevQuestionBtn').addEventListener('click', moveToPrevQuestion);
            document.getElementById('submitQuizBtn').addEventListener('click', submitQuiz);
            document.getElementById('retakeQuizBtn').addEventListener('click', resetQuiz);

            // --- Flashcards Screen Event Listeners ---
            document.getElementById('startFlashcardsBtn').addEventListener('click', startFlashcards);
            document.getElementById('flipFlashcardBtn').addEventListener('click', flipFlashcard);
            document.getElementById('nextFlashcardBtn').addEventListener('click', nextFlashcard);
            document.getElementById('prevFlashcardBtn').addEventListener('click', prevFlashcard);

            // --- Community Screen Event Listeners ---
            document.getElementById('postQuestionBtn').addEventListener('click', () => {
                const questionText = document.getElementById('newQuestionText').value;
                addCommunityQuestion(questionText);
            });

            // --- Study Plan Screen Event Listeners ---
            document.getElementById('addStudyPlanItemBtn').addEventListener('click', () => {
                const itemText = document.getElementById('newStudyPlanItem').value;
                addStudyPlanItem(itemText);
            });

            // Initial screen display
            showScreen('dashboard');
        });

        // Expose showScreen globally for onclick attributes
        window.showScreen = showScreen;
    </script>
</body>
</html>
